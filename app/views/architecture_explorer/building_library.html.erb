<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building Library</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M4TLZ8N6CC"></script>
    <script defer data-domain="app.architecturehelper.com" src="https://plausible.io/js/script.js"></script>
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_MltKSavY2s3FENOZhvocfU5qHx4f8xsJTAku0H0jVLH',{api_host:'https://app.posthog.com'})
    </script>
    <style>
      .container{
        text-align: center; /* Center align the text */
        background: #FFFFFF; /* White container background */
        border-radius: 15px;
        padding: 10px;
        box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.1);
        margin-top: 10px;
        margin-bottom: 20px;
    }
      body {
          background-color: #E8E8E8; /* Sets the entire page background to black */
      }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Adjust '150px' to change the cell size */
            gap: 10px; /* Spacing between grid items */
            justify-items: center; /* Center align grid items */
            width: 100%; /* Ensure the grid takes up full container width */    
        }

        .grid-item {
            display: flex; /* Use flexbox */
            flex-direction: column; /* Stack children vertically */
            align-items: center; /* Center children horizontally */
            justify-content: flex-start; /* Align children to the start of the flex container */
            text-align: center; /* Center text */
            overflow: hidden; /* Hide parts of the image that exceed the container size */
            position: relative; /* Needed for absolute positioning of children */
            width: 200px; /* Adjust based on your design */
            margin-bottom: 20px; /* Space below each grid item */
            height: auto; /* Adjust height automatically */
        }

        .submission-image {
            width: 200px; /* Set a fixed width */
            height: 200px; /* Set a fixed height, equal to the width for a square */
            object-fit: cover; /* This will ensure the image covers the area, keeping its aspect ratio */
            margin-bottom: 0px; /* Space between image and button */
        }
        h1 {
          text-align: center;
          margin: 10px;
        }
        .button-container {
            text-align: center; /* Center the buttons */
            margin-bottom: 20px; /* Space between buttons and grid */
        }
        .btn-primary{
          width: 20%; /* Make buttons take full width of the container */
          background-color: #0056b3;
          color: white;
          border-radius: 20px;
          padding: 10px 20px;
          font-size: 18px;
          text-align: center;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          transition: all 0.3s ease;
          border: none;
          margin: 10px; /* Add spacing between buttons */
        }
        .btn-primary:hover {
          background-color: #004080; /* Darker blue on hover */
        }
        .btn-secondary {
            background-color: #E8E8E8;
            color: #0056b3; /* Adjust the color to match your theme */
            border: 2px solid #0056b3; /* Blue border */
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 18px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin: 10px
        }

        .btn-secondary:hover {
            background-color: #f0f0f0; /* Light grey for hover effect, adjust as needed */
            color: #003366; /* Darker blue for hover text */
            border-color: #003366; /* Darker blue for hover border */
        }
        .grid-btn {
            width: 200px; /* Set a fixed width */
            background-color: #E8E8E8;
            color: #0056b3;
            border: 1px solid #0056b3;
            border-top: none; /* Remove top border */
            padding: 10px 10px;
            font-size: 12px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            display: inline-block;
            text-decoration: none;
            margin: 0; /* Remove margin */
            border-radius: 0 0 10px 10px; /* Rounded corners at the bottom only */
            white-space: nowrap; /* Prevents the text from wrapping */
            overflow: hidden; /* Hides text that overflows the button's width */
            text-overflow: ellipsis; /* Adds an ellipsis to text that overflows */
            max-width: 100%;
        }
        .search-bar {
            width: 80; /* Adjust as needed */
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-inline .form-control {
                width: 100%; /* Full width for search bar on smaller screens */
                margin-bottom: 10px; /* Margin for spacing */
            }

            .form-inline .btn-sm {
                width: 100%; /* Full width for button on smaller screens */
            }
            .grid-btn {
                width: 300px; /* Set a fixed width */
        }
            .submission-image {
                width: 300px; /* Set a fixed width */
                height: 300px;
        }
            .grid-item, .submission-image {
                width: 300px; /* Make images wider on mobile */
                height: 300px; /* Adjust height accordingly to maintain aspect ratio */
            }
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* Adjust for wider images */
            }
            .btn-primary{
                width: 50%
            }
        }
        .modal-body {
            display: flex; /* Enable flexbox */
            justify-content: center; /* Center content horizontally */
            align-items: center; /* Center content vertically */
            text-align: center; /* Ensure text is centered, if any */
            height: 100%; /* Optional: Set a specific height if needed */
        }
        #modalImage {
            max-width: 100%; /* Ensures image is not larger than the container */
            max-height: 600px; /* Set a maximum height for the image */
            margin: auto; /* Add automatic margins to center the image */
        }

        .modal-footer {
            justify-content: ce
            nter; /* Centers the button in the modal footer */
        }
        #modalTags {
            display: flex; /* Use flexbox for layout */
            flex-wrap: wrap; /* Allow tags to wrap to the next line */
            justify-content: center; /* Center tags horizontally */
            margin-top: 10px; /* Add some space above the tags */
            margin-bottom: 10px; /* Add some space above the tags */
        }

        #modalTags .badge {
            margin: 2px; /* Add a little space around each tag */
        }
        .style-name {
        font-size: 16px;
        }

        .frequency-number {
        color: initial;
        }

        .frequency-number.primary-color {
        font-weight: bold;
        font-size:18px;
        color: #0056b3; /* Match this with the color of your primary buttons */
        }
        .hidden-style {
        display: none;
        }
        .unique-style-statistic h3 {
        /* Styling for the heading */
        }

        .unique-style-statistic p {
        /* Styling for the number */
        }
        .heading-container {
        text-align: center; /* Center align the content */
        }

        .parent-container {
        margin: 20px;
        display: flex;
        }

        .left-section {
        flex: 1; /* Adjust as needed */
        /* Additional styling */
        }

        .right-sections {
        flex: 2; /* Adjust as needed */
        display: flex;
        }

        .style-frequency-container, .buildings-submitted-statistic {
        flex: 1; /* Each takes half of the right-sections space */
        /* Additional styling */
        }
        .unique-number, .analyzed-number {
        font-size: 60px; /* Example size */
        font-weight: bold; /* Example weight */
        color: #0056b3; /* Example color, adjust as needed */
        /* Add more styling as needed */
        }
        .stat-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease-in-out;
            margin-bottom: 15px;
            text-align: center;
        }
        .stat-card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        .stat-icon {
            font-size: 30px;
            color: #0056b3;
            margin-bottom: 10px;
        }
        .stat-title {
            font-size: 18px;
            color: #333;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-number {
            font-size: 48px;
            color: #0056b3;
            font-weight: bold;
            margin-bottom: 5px;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .parent-container {
                flex-direction: column;
                align-items: center;
            }
            .stat-card {
                width: 80%;
                margin-bottom: 20px;
            }
            .stat-number {
                font-size: 40px; /* Slightly smaller font size on smaller screens */
            }
        }
        .show-more-less-btn {
            font-size: 18px; /* Adjust the font size as needed */
            color: #0056b3; /* You can change the color if you want */
            text-decoration: underline; /* Optional: if you want it to look like a link */
            cursor: pointer; /* Change cursor on hover */
            margin-top: 10px; /* Add some space above the button */
            /* Add any other styles you need */
        }
        #styleList {
            list-style-type: none; /* Removes the bullet points */
            padding-left: 0; /* Removes the default padding */
            /* Add any other styles as needed */
        }
        #styleList li {
            margin-bottom: 1px; /* Reduces the margin below each list item, adjust as needed */
            /* Add any other styles as needed */
        }
        .stat-number li {
            font-size: 16px; /* or your preferred size */
            margin: 4px;
        }
        .middle-section-card .stat-number {
            font-size: 20px; /* Adjust the font size for the middle card independently */
        }

        /* You might want to adjust padding or margins specifically for the middle section */
        .middle-section-card {
            padding: 8px; /* Example: Adjust padding specifically for the middle section */
        }

        /* Optionally, adjust the list presentation in the middle card */
        .middle-section-card #styleList {
            padding: 0; /* Remove default padding */
            list-style-type: none; /* Remove bullet points */
            max-height: 200px; /* Limit height to make the section less tall */
            overflow-y: auto; /* Enable scroll if content exceeds max height */
        }

        .middle-section-card #styleList li {
            margin-bottom: 5px; /* Adjust spacing between list items */
        }
        .architecture-styles-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0; /* Ensures the container stretches fully across the bottom of the .grid-item */
            display: flex;
            flex-wrap: nowrap; /* Ensures items are laid out in a single line */
            overflow-x: auto; /* Allows horizontal scrolling */
            overflow-y: hidden; /* Prevents vertical overflow */
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            padding: 5px; /* Adds some padding inside the container */
        }

        .style-pill {
            flex: 0 0 auto; /* Prevents flex items from growing or shrinking */
            margin-right: 5px; /* Spacing between pills */
            font-size: 12px;
            padding: 5px 10px;
            background-color: #0056b3;
            color: white;
            border-radius: 20px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; /* Handles overflow text */
        }

        /* Ensures there's no horizontal scrollbar */
        .architecture-styles-container::-webkit-scrollbar {
            display: none;
        }

        .architecture-styles-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .style-pill {
            margin: 5px; /* Adjust the margin value as needed */
        }
</style>
<body>
<!-- Modal Structure -->
<div id="imagePreviewModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Building Preview</h5>
            </div>
            <div class="modal-body">
                <img id="modalImage" src="" class="img-fluid" alt="Preview"/>
            </div>
                <!-- Container for tags -->
                <div id="modalTags" class="mt-6">
                </div>
            <div class="modal-footer justify-content-center">
                <a href="#" id="viewFullAnalysis" class="btn btn-primary">View Full Analysis</a>
            </div>
        </div>
    </div>
</div>

    <!-- Conditional rendering based on user login status -->
        <% if user_signed_in? %>
        <div class="heading-container">
            <h2>Your Building Stats</h2>
        </div>
        <!-- Parent container for the sections -->
        <div class="parent-container d-flex justify-content-around">
            <!-- Unique Influences & Styles Card -->
            <div class="stat-card">
                <div class="stat-icon">üèõÔ∏è</div>
                <div class="stat-title">Unique Influences & Styles</div>
                <div class="stat-number"><%= @unique_style_count %></div>
            </div>

            <!-- Frequent Styles Card -->
                <div class="stat-card middle-section-card">
                <div class="stat-icon">üåü</div>
                <div class="stat-title">Favorite Styles</div>
                <div class="stat-number">
                    <ul id="styleList">
                        <% @style_frequency.each_with_index do |(style, frequency), index| %>
                            <li class="<%= 'hidden-style' if index >= 4 %> style-list-item">
                                <span class="style-name"><%= style %>:</span>
                                <span class="frequency-number primary-color"><%= frequency %></span>
                            </li>
                        <% end %>
                    </ul>
                    <% if @style_frequency.count > 6 %>
                        <a href="javascript:void(0)" class="show-more-less-btn" id="showMore" onclick="showMoreStyles()">Show More</a>
                        <a href="javascript:void(0)" class="show-more-less-btn" id="showLess" onclick="showLessStyles()" style="display: none;">Show Less</a>
                    <% end %>
                </div>
            </div>

            <!-- Buildings Analyzed Card -->
            <div class="stat-card">
                <div class="stat-icon">üè¢</div>
                <div class="stat-title">Buildings Analyzed</div>
                <div class="stat-number"><%= @buildings_submitted_count %></div>
            </div>
        </div>
    <% else %>
        <!-- Alternative content for non-logged-in users -->
        <div class="container text-center mt-5">
            <h2>Discover and Generate Architecture</h2>
            <p>Join the community and unlock the full potential of architectural exploration</p>
            <ul class="list-unstyled">
                <li>üèõ Submit images for architectural influence analysis</li>
                <li>üåç Explore buildings from around the world</li>
                <li>üìä Track your submissions and view detailed analytics</li>
            </ul>
            <a href="/users/sign_up" class="btn btn-primary btn-lg">Sign Up Now</a>
        </div>
    <% end %>
    <div class="container">

        <h1>Community Building Library</h1>
        
        <!-- Button Container -->
        <%# <div class="button-container text-center mb-4">
            <%= link_to 'Learn About a Building', architecture_explorer_new_path, class: 'btn btn-primary mr-2' %>
            <%# <%= link_to 'Generate Architecture', step1_architecture_designer_index_path, class: 'btn btn-secondary' %>
        <%# </div> %> 
      
        <!-- Search Form -->
        <div class="row justify-content-center mb-4">
            <%= form_with(url: building_library_path, method: :get, local: true, class: "form-inline") do |form| %>
                <%= text_field_tag :search, params[:search], placeholder: "Search by style, e.g., Gothic Revival", class: 'form-control form-control-md mr-4 search-bar' %>
                <%= form.submit 'Search', class: 'btn btn-secondary btn-sm' %>
            <% end %>
        </div>

        <!-- Pill-style options for architecture styles -->
        <div class="row justify-content-center mb-4">
        <% @architecture_styles.each do |style| %>
            <%= link_to style, building_library_path(search: style), class: 'badge badge-pill badge-primary style-pill', remote: true %>
        <% end %>
        </div>

    <!-- Image Grid for Community Building Library -->
    <div class="image-grid">
        <% if @analyzed_buildings.present? %>
            <% @analyzed_buildings.each do |building| %>
            <div class="grid-item" data-toggle="modal" data-target="#imagePreviewModal"
                data-image="<%= building.image_url %>"
                data-tags="<%= JSON.parse(building.h3_contents || '[]').join(', ') rescue [] %>"
                data-link="<%= architecture_explorer_show_path(id: building.id) %>"> <!-- Ensure this is correctly placed -->
                <% if building.image_url.present? %>
                <%= image_tag building.image_url, alt: "Building Image", class: "submission-image", loading: "lazy" %>
                <% else %>
                <!-- Display a placeholder image or message if the image_url is missing -->
                <p>No image available</p>
                <% end %>
                <!-- Architecture styles container -->
                <div class="architecture-styles-container">
                    <% JSON.parse(building.h3_contents || '[]').each do |style| %>
                        <span class="badge badge-primary style-pill"><%= style %></span>
                    <% end %>
                </div>
            </div>
            <% end %>
        <% else %>
            <p>No analyzed buildings found in the community library.</p>
        <% end %>
    </div>
    <%= paginate @analyzed_buildings %>
    </div>
    </div>
<script>
    function showMoreStyles() {
        var hiddenStyles = document.getElementsByClassName('hidden-style');
        for (var i = 0; i < hiddenStyles.length; i++) {
            hiddenStyles[i].style.display = 'list-item';
        }
        document.getElementById('showMore').style.display = 'none';
        document.getElementById('showLess').style.display = 'inline';
    }

    // Function to show less styles
    function showLessStyles() {
        var hiddenStyles = document.getElementsByClassName('hidden-style');
        for (var i = 0; i < hiddenStyles.length; i++) {
            hiddenStyles[i].style.display = 'none';
        }
        document.getElementById('showMore').style.display = 'inline';
        document.getElementById('showLess').style.display = 'none';
    }


    // DOMContentLoaded event listener
    document.addEventListener('DOMContentLoaded', function () {
        // Event listener for 'Learn About a Building' button
        var analyzeBtn = document.getElementById('analyze-architecture-btn');
        if (analyzeBtn) {
            analyzeBtn.addEventListener('click', function() {
                window.location.href = this.getAttribute('data-href');
            });
        }

        // Event listener for 'Generate Architecture' button
        var generateBtn = document.getElementById('generate-architecture-btn');
        if (generateBtn) {
            generateBtn.addEventListener('click', function() {
                window.location.href = this.getAttribute('data-href');
            });
        }
    });

    // jQuery ready function
    $(document).ready(function() {
        $('#imagePreviewModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget); // Button that triggered the modal
            var imageUrl = button.data('image'); // Extract image URL
            var tagsString = button.data('tags'); // Extract tags
            var analysisLink = button.data('link'); // Extract link to the full analysis page

            // Update the modal's content
            var modal = $(this);
            modal.find('#modalImage').attr('src', imageUrl); // Set the image URL

            // Handle tags
            var tagsContainer = modal.find('#modalTags');
            tagsContainer.empty(); // Clear previous tags
            if (tagsString) {
                var tagsArray = tagsString.split(','); // Split tags into an array
                tagsArray.forEach(function(tag) {
                    tagsContainer.append('<span class="badge badge-primary">' + tag.trim() + '</span>');
                });
            }

            // Update the 'View Full Analysis' button's href attribute
            modal.find('#viewFullAnalysis').attr('href', analysisLink);
        });
    });
</script>
</body>
</html>